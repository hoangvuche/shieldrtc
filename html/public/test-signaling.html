<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ShieldRTC Signaling Test</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #log { border: 1px solid #ccc; height: 250px; overflow-y: auto; padding: 5px; }
    input, button, textarea { margin: 5px 0; width: 100%; }
    textarea { height: 80px; }
    .welcome { color: green; font-weight: bold; }
  </style>
</head>
<body>
  <h2>ShieldRTC Signaling Test</h2>

  <label>Server URL:</label>
  <input id="serverUrl" value="wss://app.shieldrtc.com/signaling" />

  <label>User ID:</label>
  <input id="userId" placeholder="userA" />

  <button onclick="connect()">Connect</button>

  <h3>Send Message</h3>
  <label>To (target user):</label>
  <input id="targetId" placeholder="userB" />

  <label>Message JSON:</label>
  <textarea id="messageBody">{ "type":"offer","sdp":"fake-sdp" }</textarea>

  <button onclick="sendMessage()">Send</button>

  <h3>Log</h3>
  <div id="log"></div>

  <script>
    let ws;

    function log(msg, cssClass="") {
      const logBox = document.getElementById("log");
      const div = document.createElement("div");
      if (cssClass) div.className = cssClass;
      div.textContent = msg;
      logBox.appendChild(div);
      logBox.scrollTop = logBox.scrollHeight;
    }

    function connect() {
      const url = document.getElementById("serverUrl").value;
      const userId = document.getElementById("userId").value;

      ws = new WebSocket(url);

      ws.onopen = () => {
        log("‚úÖ Connected to " + url);
        ws.send(JSON.stringify({ type: "register", id: userId }));
        log("üì§ Sent register for " + userId);
      };

      ws.onmessage = (event) => {
        try {
          const msg = JSON.parse(event.data);
          if (msg.type === "welcome") {
            log(`üéØ Connected to signaling instance: ${msg.instance}`, "welcome");
          } else {
            log("üì• " + event.data);
          }
        } catch {
          log("üì• " + event.data);
        }
      };

      ws.onclose = () => log("‚ùå Connection closed");
      ws.onerror = (err) => log("‚ö†Ô∏è Error: " + err.message);
    }

    function sendMessage() {
      if (!ws || ws.readyState !== WebSocket.OPEN) {
        log("‚ö†Ô∏è WebSocket not connected");
        return;
      }
      const fromId = document.getElementById("userId").value;
      const toId = document.getElementById("targetId").value;
      let body;
      try {
        body = JSON.parse(document.getElementById("messageBody").value);
      } catch (e) {
        log("‚ö†Ô∏è Invalid JSON body");
        return;
      }
      const msg = Object.assign({ from: fromId, to: toId }, body);
      ws.send(JSON.stringify(msg));
      log("üì§ " + JSON.stringify(msg));
    }
  </script>
</body>
</html>
