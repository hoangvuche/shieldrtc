<!DOCTYPE html>
<html>
<head>
  <title>LiveKit Demo</title>
  <script src="https://unpkg.com/livekit-client/dist/livekit-client.umd.js"></script>
  <style>
    .main-container {
      padding: 10px;
    }

    input, button {
      padding: 8px;
      font-size: 16px;
    }

    #createRoomBtn {
      margin-bottom: 5px;
    }

    video {
      width: 300px;
      height: 200px;
      margin: 5px;
      background: black;
    }

    /* Flip mirror cho tất cả video gắn class này */
    .mirror-video {
      transform: scaleX(-1);
      transform-origin: center center;
    }

    .section {
      display: flex;
      gap: 4px;
    }

    #mediaWrapper {
      display: flex;
      align-items: center;
    }

    #createdRoom, #joinSection {
      align-items: center;
    }

    #chatBox {
      width: 610px; 
      height: 150px; 
      border: 1px solid #ccc; 
      padding: 5px; 
      overflow-y: auto; 
      margin-bottom: 5px;
      box-sizing: border-box;
    }

    #chatInput {
      width: 520px; 
    }

    #toggleCameraBtn,
    #toggleMicBtn,
    #switchCameraBtn,
    #toggleSpeakerBtn {
      margin-left: 4px;
      border: none;
      cursor: pointer;
      padding: 2px 4px;
    }

    .material-symbols-outlined {
      font-family: 'Material Symbols Outlined';
      font-weight: normal;
      font-style: normal;
      font-size: 24px;
      line-height: 1;
      display: inline-block;
      text-transform: none;
      letter-spacing: normal;
      white-space: nowrap;
      word-wrap: normal;
      direction: ltr;
      -webkit-font-feature-settings: 'liga';
      -webkit-font-smoothing: antialiased;
    }

    .icon-btn {
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      border: none;
      background: transparent;
      cursor: pointer;
    }

    .icon-btn:hover {
      background-color: rgba(0,0,0,0.2);
    }

    /* Dùng chung với .icon-btn: <button class="icon-btn sensitive-btn"> */
    .icon-btn.sensitive-btn {
      background-color: rgba(220, 53, 69, 0.9); /* đỏ kiểu danger */
      color: #fff;
    }

    .icon-btn.sensitive-btn:hover {
      background-color: rgba(220, 53, 69, 1);
    }

    /* Nếu muốn trạng thái “bình thường” khác với “đang tắt mic” */
    .icon-btn.sensitive-btn.is-muted {
      background-color: rgba(220, 53, 69, 0.95);
      color: #fff;
    }

    .icon-btn.sensitive-btn.is-muted:hover {
      background-color: #c82333;
    }

    #videos {
      display: flex;
      flex-wrap: wrap;
      justify-content: left;
    }

    @media screen and (max-width: 640px) {
      input, button {
        width: 100%;
        box-sizing: border-box;
        margin-bottom: 5px;
      }

      .section:not(#createdRoom) {
        width: 100%;
        flex-direction: column;
      }

      #chatBox, #chatInput {
        width: 100%;
      }

      #videos {
        justify-content: center;
      }
    }
  </style>
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined&display=block" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <div class="main-container">
    <h2>ShieldRTC Demo</h2>

    <!-- Form login -->
    <div class="section">
      <input type="text" id="username" placeholder="Username">
      <input type="password" id="password" placeholder="Password">
      <button id="loginBtn">Login</button>
    </div>
    <br><br>

    <!-- Create room -->
    <button id="createRoomBtn" disabled>Create Room</button>
    <div id="createdRoom" class="section">
      Created Room ID: <span id="createdRoomId"></span>
      <button id="copyRoom" class="icon-btn" title="Turn camera off">
        <span class="material-symbols-outlined">content_copy</span>
      </button>
    </div>
    <br>

    <div id="joinSection" class="section">
      <!-- Join room -->
      <input type="text" id="roomId" placeholder="Enter Room ID">
      <button id="joinBtn" disabled>Join Room</button>
      <button id="endBtn" disabled style="color: red;">End Call</button>

      <div id="mediaWrapper">

        <!-- Toggle camera -->
        <button id="toggleCameraBtn" class="icon-btn" disabled title="Turn camera off">
          <span class="material-symbols-outlined">videocam</span>
        </button>

        <!-- Switch camera front/back -->
        <button id="switchCameraBtn" class="icon-btn" disabled title="Switch camera">
          <span class="material-symbols-outlined">switch_camera</span>
        </button>

        <!-- Toggle call speaker -->
        <button id="toggleSpeakerBtn" class="icon-btn" disabled title="Mute call audio">
          <span class="material-symbols-outlined">volume_up</span>
        </button>

        <!-- Toggle mic -->
        <button id="toggleMicBtn" class="icon-btn sensitive-btn" disabled title="Mute microphone">
          <span class="material-symbols-outlined">mic</span>
        </button>

      </div>
    </div>

    <h3>Videos</h3>
    <div id="videos"></div>

    <h3>Chat (ephemeral)</h3>
    <div id="chatBox">
    </div>
    <input type="text" id="chatInput" placeholder="Type a message">
    <button id="sendChatBtn" disabled>Send</button>
  </div>
<script>
const LOGIN_URL = "https://app.shieldrtc.com/api/login";
const CREATE_ROOM_URL = "https://app.shieldrtc.com/api/rooms/create";
const PORTAL_URL = "https://app.shieldrtc.com/api/token/livekit";

let SIGNAL_JWT = null;
let currentRoom = null;       // giữ instance room để disconnect
let cameraEnabled = true;     // trạng thái hiện tại của camera
let micEnabled = true;        // trạng thái hiện tại của mic
let speakerEnabled = true;    // trạng thái hiện tại của loa
let videoDevices = [];
let currentVideoDeviceIndex = 0;
let localVideoTrack = null;
let cameraFacingMode = 'user'; // 'user' = cam trước, 'environment' = cam sau
let localVideoElement = null;

// Chat related
let CHAT_USERNAME = null; // dùng tên đăng nhập để hiển thị
const textEncoder = new TextEncoder();
const textDecoder = new TextDecoder();

function appendChatMessage(sender, message, isLocal) {
  const box = document.getElementById('chatBox');
  if (!box) return;

  const line = document.createElement('div');
  line.style.marginBottom = '3px';

  if (isLocal) {
    line.style.textAlign = 'right';
    line.innerHTML = `<strong>You:</strong> ${escapeHtml(message)}`;
  } else {
    line.innerHTML = `<strong>${escapeHtml(sender)}:</strong> ${escapeHtml(message)}`;
  }

  box.appendChild(line);
  box.scrollTop = box.scrollHeight;
}

function resetChatBox() {
  const box = document.getElementById('chatBox');
  if (box) box.innerHTML = '';
}

// Simple escape để tránh chèn HTML trực tiếp
function escapeHtml(str) {
  return String(str)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");
}

document.addEventListener('DOMContentLoaded', () => {
  const toggleCameraBtn  = document.getElementById("toggleCameraBtn");
  const toggleCameraIcon = toggleCameraBtn
    ? toggleCameraBtn.querySelector('.material-symbols-outlined')
    : null;
    
  const toggleMicBtn  = document.getElementById("toggleMicBtn");
  const toggleMicIcon = toggleMicBtn
    ? toggleMicBtn.querySelector('.material-symbols-outlined')
    : null;

  const toggleSpeakerBtn  = document.getElementById("toggleSpeakerBtn");
  const toggleSpeakerIcon = toggleSpeakerBtn
  ? toggleSpeakerBtn.querySelector('.material-symbols-outlined')
  : null;

  const switchCameraBtn  = document.getElementById("switchCameraBtn");
  const switchCameraIcon = switchCameraBtn
    ? switchCameraBtn.querySelector('.material-symbols-outlined')
    : null;

  function applySpeakerMuteToCallMedia() {
    // Mute/unmute tất cả media của participants trong cuộc gọi
    const mediaEls = document.querySelectorAll('audio[data-participant], video[data-participant]');
    mediaEls.forEach(el => {
      el.muted = !speakerEnabled; // speakerEnabled=false => muted=true
    });
  }

    // Reset toàn bộ UI call -----
  function resetCallUI() {
    // Xoá toàn bộ video UI
    const videosEl = document.getElementById('videos');
    if (videosEl) {
      videosEl.innerHTML = '';
    }

    // Disable nút End Call
    const endBtn = document.getElementById('endBtn');
    if (endBtn) {
      endBtn.disabled = true;
    }

    // Chat: clear + disable gửi
    resetChatBox();
    const sendBtn = document.getElementById('sendChatBtn');
    if (sendBtn) {
      sendBtn.disabled = true;
    }

    // Camera
    if (toggleCameraBtn) {
      toggleCameraBtn.disabled = true;
    }
    cameraEnabled = true;
    if (toggleCameraIcon) {
      toggleCameraIcon.textContent = 'videocam';
    }

    // Mic
    if (toggleMicBtn) {
      toggleMicBtn.disabled = true;
    }
    micEnabled = true;
    if (toggleMicIcon) {
      toggleMicIcon.textContent = 'mic';
    }

    // Switch camera
    if (switchCameraBtn) {
      switchCameraBtn.disabled = true;
    }
    videoDevices = [];
    currentVideoDeviceIndex = 0;

    // Loa cuộc gọi
    if (toggleSpeakerBtn) {
      toggleSpeakerBtn.disabled = true;
    }
    speakerEnabled = true;
    if (toggleSpeakerIcon) {
      toggleSpeakerIcon.textContent = 'volume_up';
    }
    applySpeakerMuteToCallMedia();

    // Dọn thêm state local video (cho sạch sẽ)
    localVideoTrack = null;
    localVideoElement = null;
    cameraFacingMode = 'user';
  }

  // ----- Helper: cập nhật UI cho nút mic -----
  function updateMicUI() {
    if (!toggleMicBtn) return;

    // icon + tooltip
    if (toggleMicIcon) {
      toggleMicIcon.textContent = micEnabled ? 'mic' : 'mic_off';
    }
    toggleMicBtn.title = micEnabled ? 'Mute microphone' : 'Unmute microphone';

    // trạng thái màu (class is-muted)
    if (micEnabled) {
      toggleMicBtn.classList.remove('is-muted');
    } else {
      toggleMicBtn.classList.add('is-muted');
    }
  }
  
  // Đăng nhập
  document.getElementById("loginBtn").onclick = async () => {
    try {
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      const res = await fetch(LOGIN_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password })
      });

      const data = await res.json();
      if (data.signal_jwt) {
        SIGNAL_JWT = data.signal_jwt;
        CHAT_USERNAME = username || 'User';

        document.getElementById("createRoomBtn").disabled = false;
        document.getElementById("joinBtn").disabled = false;
        alert("Login success! You can now create or join a room.");
      } else {
        alert("Login failed: " + JSON.stringify(data));
      }
    } catch (err) {
      console.error("Login error:", err);
    }
  };

  // Copy Room ID
  document.getElementById("copyRoom").onclick = () => {
    const roomId = document.getElementById("createdRoomId").innerText;
    if (roomId) {
      navigator.clipboard.writeText(roomId).then(() => {
        alert("Copied Room ID to clipboard: " + roomId);
      });
    }
  };

  // Gửi chat khi nhấn Enter
  document.getElementById('chatInput').addEventListener('keydown', function(event) {
    if (event.key === 'Enter') {
      event.preventDefault();
      document.getElementById('sendChatBtn').click();
    }
  });

  // Tạo phòng
  document.getElementById("createRoomBtn").onclick = async () => {
    try {
      const res = await fetch(CREATE_ROOM_URL, {
        method: "POST",
        headers: { 
          "Authorization": "Bearer " + SIGNAL_JWT,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ title: "Test Room" })
      });
      const data = await res.json();

      if (data.room_id) {
        document.getElementById("createdRoomId").innerText = data.room_id;
        document.getElementById("roomId").value = data.room_id;
      } else {
        alert("Create room failed: " + JSON.stringify(data));
      }
    } catch (err) {
      console.error("Create room error:", err);
    }
  };

  // Join phòng
  document.getElementById("joinBtn").onclick = async () => {
    try {
      const roomId = document.getElementById("roomId").value.trim();
      if (!roomId) {
        alert("Please enter a room ID first!");
        return;
      }

      // 1. Xin LiveKit token
      const res = await fetch(PORTAL_URL, {
        method: "POST",
        headers: { 
          "Authorization": "Bearer " + SIGNAL_JWT,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ room: roomId })
      });

      let data = null;
      try {
        data = await res.json();
      } catch (e) {
        console.error("Parse token response failed:", e);
      }

      // Nếu request lỗi hoặc thiếu dữ liệu cần thiết → stop
      if (!res.ok || !data || !data.livekit_url || !data.livekit_jwt) {
        let msg = "Không thể lấy token kết nối.";
        if (data && (data.message || data.error || data.detail)) {
          msg = data.message || data.error || data.detail;
        }
        alert("Join room failed: " + msg);

        if (typeof resetCallUI === "function") {
          resetCallUI();
        }
        return; // ❌ KHÔNG connect, KHÔNG mở cam local
      }
      
      // 2. Tạo Room instance
      const room = new LivekitClient.Room();
      currentRoom = room; // lưu để end call

      // Khi mất kết nối (host xóa phòng, bị kick, lỗi unrecoverable...)
      room.on('disconnected', (reason) => {
        console.log('[Room disconnected]', {
          reason,
          reasonName: LivekitClient.DisconnectReason
            ? Object.keys(LivekitClient.DisconnectReason)
                .find(k => LivekitClient.DisconnectReason[k] === reason)
            : undefined,
          roomState: room.state,
        });

        // Xoá toàn bộ video UI
        document.getElementById('videos').innerHTML = '';
        document.getElementById('endBtn').disabled = true;

        // Chat: xóa luôn
        resetChatBox();
        const sendBtn = document.getElementById("sendChatBtn");
        if (sendBtn) sendBtn.disabled = true;

        if (toggleCameraBtn) {
          toggleCameraBtn.disabled = true;
        }
        cameraEnabled = true;
        if (toggleCameraIcon) {
          toggleCameraIcon.textContent = 'videocam';
        }

        if (toggleMicBtn) {
          toggleMicBtn.disabled = true;
        }
        micEnabled = true;
        if (toggleMicIcon) {
          toggleMicIcon.textContent = 'mic';
        }

        if (switchCameraBtn) {
          switchCameraBtn.disabled = true;
        }
        videoDevices = [];
        currentVideoDeviceIndex = 0;

        if (toggleSpeakerBtn) {
          toggleSpeakerBtn.disabled = true;
        }
        speakerEnabled = true;
        if (toggleSpeakerIcon) {
          toggleSpeakerIcon.textContent = 'volume_up';
        }
        applySpeakerMuteToCallMedia(); // để chắc ăn, nếu còn media
        
        if (reason === LivekitClient.DisconnectReason.ROOM_DELETED) {
          alert("Host ended the room.");
        } else if (reason === LivekitClient.DisconnectReason.DUPLICATE_IDENTITY) {
          alert("You were disconnected because your identity is used elsewhere.");
        } else if (reason === LivekitClient.DisconnectReason.JOIN_FAILURE) {
          alert("Cannot join this room. Please try again.");
        } else {
          // UNKNOWN / others → chỉ log, không alert
          console.warn("Disconnected:", reason);
        }
      });

      // 3. Event: khi có track remote
      room.on('trackSubscribed', (track, publication, participant) => {
        if (track.kind === 'video') {
          const el = track.attach();
          el.dataset.participant = participant.sid;
          document.getElementById('videos').appendChild(el);
        } else if (track.kind === 'audio') {
          const el = track.attach();
          el.dataset.participant = participant.sid;
          el.style.display = 'none';
          document.body.appendChild(el);

          // NEW: nếu loa đang tắt thì audio mới cũng phải tắt theo
          el.muted = !speakerEnabled;
        }
      });

      // Participant leave → gỡ video element
      room.on('participantDisconnected', (participant) => {
        document.querySelectorAll(`[data-participant="${participant.sid}"]`)
          .forEach(el => el.remove());
      });

      // Nhận data (chat) từ participant khác
      room.on('dataReceived', (payload, participant, kind, topic) => {
        try {
          const text = textDecoder.decode(payload);
          let msgObj = null;
          try {
            msgObj = JSON.parse(text);
          } catch (e) {
            // không phải JSON, fallback dùng raw text
          }

          if (msgObj && msgObj.type === 'chat') {
            const senderName =
              msgObj.sender ||
              (participant && participant.identity) ||
              'Peer';
            appendChatMessage(senderName, msgObj.text || '', false);
          } else {
            const senderName =
              (participant && participant.identity) ||
              'Peer';
            appendChatMessage(senderName, text, false);
          }
        } catch (e) {
          console.error('Decode chat failed:', e);
        }
      });

      // 4. Connect LiveKit
      await room.connect(data.livekit_url, data.livekit_jwt);

      // 5. Publish local tracks
      const localTracks = await LivekitClient.createLocalTracks({
        audio: true,
        video: { facingMode: cameraFacingMode }, // mặc định cam trước
      });

      for (const track of localTracks) {
        await room.localParticipant.publishTrack(track);

        if (track.kind === 'video') {
          const el = track.attach();
          el.dataset.participant = room.localParticipant.sid;

          // lưu lại để dùng cho flip camera
          localVideoTrack = track;
          localVideoElement = el;

          // CHỈ mirror nếu đang dùng camera trước
          if (cameraFacingMode === 'user') {
            el.classList.add('mirror-video');
          }

          document.getElementById('videos').appendChild(el);
        }

        // ⚠️ KHÔNG attach audio cho local
        // if (track.kind === 'audio') {
        //   // không track.attach() -> không tự nghe chính mình
        // }
      }

      document.getElementById("endBtn").disabled = false;

      // Chat: cho phép gửi khi đã connect
      const sendBtn = document.getElementById("sendChatBtn");
      if (sendBtn) sendBtn.disabled = false;

      console.log("Connected to room:", room.name);

      if (toggleCameraBtn) {
        cameraEnabled = true;
        toggleCameraBtn.disabled = false;
        if (toggleCameraIcon) {
          toggleCameraIcon.textContent = 'videocam';
        }
        toggleCameraBtn.title = 'Turn camera off';
      }

      if (toggleMicBtn) {
        micEnabled = true;
        toggleMicBtn.disabled = false;
        if (toggleMicIcon) {
          toggleMicIcon.textContent = 'mic';
        }
        toggleMicBtn.title = 'Mute microphone';
      }

      // Chuẩn bị danh sách camera để switch trước/sau
      if (switchCameraBtn) {
        switchCameraBtn.disabled = false;
      }

      // NEW: bật nút mute speaker
      if (toggleSpeakerBtn) {
        speakerEnabled = true;
        toggleSpeakerBtn.disabled = false;
        if (toggleSpeakerIcon) {
          toggleSpeakerIcon.textContent = 'volume_up';
        }
        toggleSpeakerBtn.title = 'Mute call audio';
      }

    } catch (err) {
      console.error("Join failed:", err);
    }
  };

  // Gửi tin nhắn chat
  document.getElementById("sendChatBtn").onclick = async () => {
    const input = document.getElementById("chatInput");
    if (!input) return;

    const text = input.value.trim();
    if (!text) return;

    if (!currentRoom) {
      alert("You are not connected to a room.");
      return;
    }

    try {
      const payloadObj = {
        type: 'chat',
        text: text,
        sender: CHAT_USERNAME || 'User',
        ts: Date.now()
      };

      const encoded = textEncoder.encode(JSON.stringify(payloadObj));

      // Gửi data dạng reliable để chat không mất gói
      await currentRoom.localParticipant.publishData(encoded, { reliable: true });

      appendChatMessage('You', text, true);
      input.value = '';
    } catch (e) {
      console.error('Send chat error:', e);
    }
  };

  // Toggle camera
  if (toggleCameraBtn) {
    toggleCameraBtn.onclick = async () => {
      if (!currentRoom) return;
      try {
        // đảo trạng thái
        cameraEnabled = !cameraEnabled;

        // LiveKit sẽ mute/unmute track camera đang publish
        await currentRoom.localParticipant.setCameraEnabled(cameraEnabled);

        // cập nhật icon + tooltip
        if (toggleCameraIcon) {
          toggleCameraIcon.textContent = cameraEnabled ? 'videocam' : 'videocam_off';
        }
        toggleCameraBtn.title = cameraEnabled ? 'Turn camera off' : 'Turn camera on';
      } catch (e) {
        console.error("Toggle camera error:", e);
      }
    };
  }

  // Switch camera (front/back)
  if (switchCameraBtn) {
    switchCameraBtn.onclick = async () => {
      if (!localVideoTrack) return;

      // Đảo hướng: trước <-> sau
      cameraFacingMode = cameraFacingMode === 'user' ? 'environment' : 'user';

      try {
        await localVideoTrack.restartTrack({
          facingMode: cameraFacingMode,
        });

        // Cập nhật mirror cho video local
        if (localVideoElement) {
          if (cameraFacingMode === 'user') {
            localVideoElement.classList.add('mirror-video');
          } else {
            localVideoElement.classList.remove('mirror-video');
          }
        }

        console.log('Switched camera to', cameraFacingMode);
      } catch (e) {
        console.error('Switch camera failed:', e);
      }
    };
  }

  // Toggle mic
  if (toggleMicBtn) {
    toggleMicBtn.onclick = async () => {
      if (!currentRoom) return;
      try {
        // đảo trạng thái
        micEnabled = !micEnabled;

        // LiveKit sẽ mute/unmute track mic đang publish
        await currentRoom.localParticipant.setMicrophoneEnabled(micEnabled);

        // cập nhật icon + tooltip
        updateMicUI();

      } catch (e) {
        console.error("Toggle mic error:", e);
      }
    };
  }

  // Toggle speaker (call audio)
  if (toggleSpeakerBtn) {
    toggleSpeakerBtn.onclick = () => {
      if (!currentRoom) return;

      // Đảo trạng thái loa
      speakerEnabled = !speakerEnabled;

      // Áp mute/unmute cho toàn bộ media của call
      applySpeakerMuteToCallMedia();

      // Cập nhật icon + tooltip
      if (toggleSpeakerIcon) {
        toggleSpeakerIcon.textContent = speakerEnabled ? 'volume_up' : 'volume_off';
      }
      toggleSpeakerBtn.title = speakerEnabled ? 'Mute call audio' : 'Unmute call audio';
    };
  }

  // End call
  document.getElementById("endBtn").onclick = async () => {
    const roomId = document.getElementById("roomId").value.trim();
    if (!roomId) { alert("Missing room id"); return; }

    try {
      // YÊU CẦU backend đóng phòng (nếu không phải host, backend trả 403)
      const res = await fetch("https://app.shieldrtc.com/api/rooms/end", {
        method: "POST",
        headers: {
          "Authorization": "Bearer " + SIGNAL_JWT,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ room_id: roomId })
      });

      if (!res.ok) {
        const err = await res.json().catch(() => ({}));
        console.warn("End room failed:", err);
        alert(err.error || "Only host can end this room (or server error).");
        // Dù không phải host, vẫn cho phép *rời phòng cá nhân*
      }
    } catch (e) {
      console.error("End room error:", e);
    }

    // Rời phòng local (UI của người khác sẽ được server kick → họ tự nhận 'disconnected')
    if (currentRoom) {
      await currentRoom.disconnect();
      currentRoom = null;
    }
    document.getElementById("videos").innerHTML = "";
    document.getElementById("endBtn").disabled = true;
    resetChatBox();
    const sendBtn = document.getElementById("sendChatBtn");
    if (sendBtn) sendBtn.disabled = true;

    if (toggleCameraBtn) {
      toggleCameraBtn.disabled = true;
    }
    cameraEnabled = true;
    if (toggleCameraIcon) {
      toggleCameraIcon.textContent = 'videocam';
    }

    if (toggleMicBtn) {
      toggleMicBtn.disabled = true;
    }
    micEnabled = true;
    updateMicUI();

    if (switchCameraBtn) {
      switchCameraBtn.disabled = true;
    }
    videoDevices = [];
    currentVideoDeviceIndex = 0;

    // NEW: reset loa
    if (toggleSpeakerBtn) {
      toggleSpeakerBtn.disabled = true;
    }
    speakerEnabled = true;
    if (toggleSpeakerIcon) {
      toggleSpeakerIcon.textContent = 'volume_up';
    }
    applySpeakerMuteToCallMedia();
  };
});
</script>
</body>
</html>
